<!DOCTYPE html>

<html dir="rtl" lang="fa">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>تحویل غذای ایزو - سامانه تحویل غذا با پیک - مدیریت و گزارش‌گیری</title>
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
<style>

    body {

      font-family: 'Vazirmatn', sans-serif;

      background: linear-gradient(135deg, #f0f4ff, #d9e4ff);

      margin: 0;

      padding: 0;

      color: #2c3e50;

      min-height: 100vh;

      display: flex;

      justify-content: center;

      align-items: flex-start;

      padding-top: 40px;

      user-select: none;

    }

 

    #app {

      background: #ffffff;

      border-radius: 16px;

      box-shadow: 0 14px 32px rgba(0, 49, 135, 0.2);

      width: 420px;

      max-width: 95vw;

      padding: 30px 40px 40px 40px;

      box-sizing: border-box;

      transition: box-shadow 0.3s ease;

    }

    #app:hover {

      box-shadow: 0 18px 44px rgba(0, 49, 135, 0.3);

    }

 

    header#app-header {

      display: flex;

      flex-direction: column;

      align-items: center;

      margin-bottom: 30px;

      border-bottom: 1.5px solid #dde6f7;

      padding-bottom: 10px;

    }

    header#app-header h1.brand-name {

      font-size: 2.4rem;

      font-weight: 900;

      color: #e63946;

      margin: 0 0 6px 0;

      letter-spacing: 2px;

      font-family: 'Vazirmatn', sans-serif;

    }

    header#app-header h2.app-title {

      font-size: 1.5rem;

      color: #1f3c88;

      margin: 0;

      letter-spacing: 1.2px;

    }

    #logout-btn {

      background-color: #e74c3c;

      border: none;

      padding: 8px 20px;

      border-radius: 50px;

      color: white;

      font-weight: 700;

      font-size: 14px;

      cursor: pointer;

      box-shadow: 0 7px 12px rgba(231, 76, 60, 0.4);

      transition: background-color 0.3s ease, box-shadow 0.3s ease;

      display: none;

      margin-top: 10px;

    }

    #logout-btn:hover {

      background-color: #c0392b;

      box-shadow: 0 10px 18px rgba(192, 57, 43, 0.6);

    }

 

    h2 {

      text-align: center;

      margin-bottom: 24px;

      color: #34495e;

      font-weight: 700;

      font-size: 1.9rem;

      letter-spacing: 0.3px;

    }

 

    label {

      display: block;

      margin-bottom: 10px;

      font-weight: 600;

      color: #5a6a8d;

      font-size: 15px;

    }

    input, select, textarea {

      width: 100%;

      padding: 11px 14px;

      margin-bottom: 20px;

      border: 2px solid #cbd4f5;

      border-radius: 12px;

      font-size: 15px;

      color: #1c2a48;

      box-shadow: inset 1px 1px 5px #e3e9ff;

      transition: border-color 0.25s ease, box-shadow 0.25s ease;

      resize: vertical;

      font-family: 'Vazirmatn', sans-serif;

    }

    input::placeholder, textarea::placeholder {

      color: #8a9edc;

      font-weight: 500;

    }

    input:focus, select:focus, textarea:focus {

      border-color: #3469e7;

      box-shadow: 0 0 8px #4c7dfd80;

      outline: none;

    }

    input[type="file"] {

      padding: 4px 8px;

      border: 2px solid #cbd4f5;

      border-radius: 12px;

      cursor: pointer;

    }

 

    .receipt-preview {

      margin-top: 10px;

      max-width: 100%;

      max-height: 150px;

      border: 1px solid #cbd4f5;

      border-radius: 8px;

      object-fit: contain;

      display: none;

    }

 

    .payment-link-container {

      margin-top: 8px;

      font-weight: 700;

      color: #3469e7;

      text-align: center;

      border: 1.5px solid #3469e7;

      border-radius: 8px;

      padding: 8px;

      user-select: text;

      cursor: pointer;

    }

    .payment-link-container a {

      color: #3469e7;

      text-decoration: none;

      font-weight: 700;

    }

    .payment-link-container a:hover {

      text-decoration: underline;

    }

 

    button, .link-button {

      font-family: 'Vazirmatn', sans-serif;

      font-weight: 700;

      cursor: pointer;

      border-radius: 30px;

      transition: background-color 0.3s ease, color 0.3s ease;

      text-align: center;

    }

    button {

      background-color: #3469e7;

      border: none;

      color: white;

      padding: 13px 18px;

      font-size: 16px;

      box-shadow: 0 8px 20px rgba(52, 105, 231, 0.3);

      width: 100%;

    }

    button:hover {

      background-color: #1f54c7;

      box-shadow: 0 12px 32px rgba(31, 84, 199, 0.5);

    }

    .link-button {

      background: none;

      border: none;

      color: #3469e7;

      padding: 0;

      font-size: 15px;

      margin-top: 12px;

      width: 100%;

      text-decoration: underline;

    }

    .link-button:hover {

      color: #234a9f;

    }

 

    .error {

      color: #e74c3c;

      font-size: 14px;

      margin-bottom: 12px;

      text-align: center;

      font-weight: 600;

      letter-spacing: 0.3px;

      opacity: 0.95;

    }

    .success {

      color: #27ae60;

      font-size: 14px;

      margin-bottom: 12px;

      text-align: center;

      font-weight: 600;

      letter-spacing: 0.3px;

      opacity: 0.95;

    }

 

    /* Cards for request list and reports */

    .card {

      border: 1.8px solid #cbd4f5;

      background-color: #f5f7ff;

      box-shadow: 5px 6px 16px -10px rgba(52, 105, 231, 0.4);

      padding: 18px 20px;

      border-radius: 16px;

      margin-bottom: 16px;

      font-size: 15px;

      color: #243b6b;

      transition: transform 0.3s ease, box-shadow 0.3s ease;

      user-select: text;

      position: relative;

    }

    .card:hover {

      transform: translateY(-4px);

      box-shadow: 8px 10px 26px -8px rgba(52, 105, 231, 0.6);

    }

    .card.highlight {

      border-color: #3469e7;

      background-color: #e4ebff;

    }

 

    .request-info {

      margin-bottom: 8px;

      line-height: 1.4;

      user-select: text;

    }

    .request-info > span {

      font-weight: 600;

    }

 

    /* Status badges */

    .request-status {

      font-weight: 700;

      padding: 4px 14px;

      border-radius: 100px;

      font-size: 14px;

      color: #fff;

      display: inline-block;

      user-select: none;

      box-shadow: 0 2px 10px #00000025;

      letter-spacing: 0.3px;

    }

    .status-pending {

      background-color: #3498db;

    }

    .status-accepted {

      background-color: #27ae60;

    }

    .status-delivered {

      background-color: #718096;

    }

 

    .btn-accept {

      background-color: #27ae60;

      color: white;

      border: none;

      border-radius: 12px;

      padding: 8px 18px;

      cursor: pointer;

      font-weight: 700;

      font-size: 15px;

      margin-top: 10px;

      box-shadow: 0 8px 20px rgba(39, 174, 96, 0.4);

      width: 100%;

      transition: background-color 0.3s ease;

      user-select: none;

    }

    .btn-accept:hover {

      background-color: #1e8449;

      box-shadow: 0 12px 28px rgba(30, 132, 73, 0.6);

    }

 

    .btn-paid {

      background-color: #2980b9;

      border: none;

      border-radius: 12px;

      color: white;

      padding: 6px 14px;

      font-weight: 700;

      font-size: 14px;

      cursor: pointer;

      margin-top: 10px;

      box-shadow: 0 5px 15px rgba(41, 128, 185, 0.4);

      user-select: none;

      transition: background-color 0.3s ease;

    }

    .btn-paid:hover {

      background-color: #1c5980;

    }

 

    /* Dashboard containers */

    #requester-dashboard, #courier-dashboard, #admin-dashboard {

      margin-top: 10px;

    }

 

    /* Admin report cards container */

    #admin-reports {

      display: flex;

      flex-direction: column;

      gap: 14px;

      margin-top: 20px;

    }

 

    /* Scroll container for courier requests */

    #courier-requests-list {

      max-height: 420px;

      overflow-y: auto;

      padding-right: 6px;

    }

 

    /* Scrollbar styling */

    #courier-requests-list::-webkit-scrollbar {

      width: 6px;

    }

    #courier-requests-list::-webkit-scrollbar-track {

      background: transparent;

    }

    #courier-requests-list::-webkit-scrollbar-thumb {

      background-color: #3469e7;

      border-radius: 10px;

      opacity: 0.7;

      transition: opacity 0.3s ease;

    }

    #courier-requests-list::-webkit-scrollbar-thumb:hover {

      opacity: 1;

    }

    /* Transitions for showing / hiding */

    .hidden {

      display: none !important;

    }

 

    /* Icons styling */

    .material-icons {

      vertical-align: middle;

      margin-left: 6px;

      font-size: 18px;

      color: #3469e7;

    }

 

    /* Report list table */

    table.report-table {

      width: 100%;

      border-collapse: collapse;

    }

    table.report-table th, table.report-table td {

      text-align: center;

      padding: 6px 12px;

      border-bottom: 1.5px solid #cbd4f5;

      font-size: 14px;

      color: #2c3e50;

    }

    table.report-table th {

      background-color: #e3e9ff;

      font-weight: 700;

    }

    table.report-table tr:hover {

      background-color: #d0d9ff;

    }

  </style>
</head>
<body>
<div id="app">
<header aria-label="سرصفحه برنامه" id="app-header">
<h1 class="brand-name">ایزو فود</h1>
<h2 class="app-title">سامانه تحویل غذا با پیک</h2>
<button aria-label="خروج" id="logout-btn" title="خروج از حساب کاربری">خروج</button>
</header>
<section id="auth-section" role="main">
<div aria-label="فرم ورود" id="login-form">
<h2>ورود به سامانه</h2>
<label for="login-username">نام کاربری <span aria-hidden="true" class="material-icons">person</span></label>
<input aria-required="true" autocomplete="username" id="login-username" placeholder="نام کاربری خود را وارد کنید" type="text"/>
<label for="login-password">رمز عبور <span aria-hidden="true" class="material-icons">lock</span></label>
<input aria-required="true" autocomplete="current-password" id="login-password" placeholder="رمز عبور خود را وارد کنید" type="password"/>
<label for="login-role">نقش <span aria-hidden="true" class="material-icons">badge</span></label>
<select aria-required="true" id="login-role">
<option value="requester">درخواست کننده</option>
<option value="courier">پیک</option>
<option value="admin">ادمین</option>
</select>
<button aria-label="ورود" id="login-btn">ورود</button>
<button aria-label="رفتن به ثبت نام" class="link-button" id="show-signup-btn">ثبت نام جدید</button>
<div class="error" id="login-error" role="alert" style="display:none;"></div>
</div>
<div aria-label="فرم ثبت نام" class="hidden" id="signup-form">
<h2>ثبت نام</h2>
<label for="signup-username">نام کاربری <span aria-hidden="true" class="material-icons">person_add</span></label>
<input aria-required="true" autocomplete="username" id="signup-username" placeholder="نام کاربری دلخواه" type="text"/>
<label for="signup-password">رمز عبور <span aria-hidden="true" class="material-icons">lock</span></label>
<input aria-required="true" autocomplete="new-password" id="signup-password" placeholder="رمز عبور دلخواه" type="password"/>
<label for="signup-role">نقش <span aria-hidden="true" class="material-icons">assignment_ind</span></label>
<select aria-required="true" id="signup-role">
<option value="requester">درخواست کننده</option>
<option value="courier">پیک</option>
<option value="admin">ادمین</option>
</select>
<button aria-label="ثبت نام" id="signup-btn">ثبت نام</button>
<button aria-label="برگشت به ورود" class="link-button" id="show-login-btn">بازگشت به ورود</button>
<div class="error" id="signup-error" role="alert" style="display:none;"></div>
<div class="success" id="signup-success" role="status" style="display:none;"></div>
</div>
</section>
<section aria-label="داشبورد درخواست کننده" class="hidden" id="requester-dashboard">
<h2>درخواست تحویل غذای جدید</h2>
<label for="food-desc">توضیحات غذا</label>
<textarea aria-required="true" id="food-desc" placeholder="مثلا: وعده ناهار یا شام" rows="3"></textarea>
<label for="delivery-address">آدرس تحویل</label>
<textarea aria-required="true" id="delivery-address" placeholder="مثلا: شماره اتاق را وارد کنید" rows="2"></textarea>
<!-- Added payment link text below upload -->
<div aria-label="لینک پرداخت" class="payment-link-container">
<a href="https://zarinp.al/712694" rel="noopener noreferrer" target="_blank">پرداخت سریع: https://zarinp.al/712694</a>
</div>
<br/>
<div style="margin-bottom: 16px; padding: 12px; background: #f0f4ff; border: 1.5px solid #3469e7; border-radius: 10px; color: #3469e7; font-weight: 700; font-size: 15px; text-align: center;">

        شماره کارت پرداخت: <span style="letter-spacing: normal;">6063731175793711</span>
<br/>
        به نام علی شهبازی
      </div>
<label for="receipt-upload">آپلود تصویر رسید واریزی</label>
<input accept="image/*" aria-label="آپلود تصویر رسید واریزی" id="receipt-upload" type="file"/>
<img alt="پیش نمایش تصویر رسید واریزی" class="receipt-preview" id="receipt-preview"/>
<br/>
<button aria-label="ثبت درخواست و پرداخت" id="place-request-btn">ثبت درخواست و پرداخت</button>
<h2 style="margin-top: 30px;">پیگیری درخواست‌ها</h2>
<div aria-live="polite" aria-relevant="additions" id="requester-requests-list"></div>
</section>
<section aria-label="داشبورد پیک" class="hidden" id="courier-dashboard">
<h2>درخواست‌های تحویل غذا</h2>
<div aria-live="polite" aria-relevant="additions" id="courier-requests-list"></div>
</section>
<section aria-label="داشبورد ادمین" class="hidden" id="admin-dashboard">
<h2>گزارش‌گیری و مدیریت</h2>
<div id="admin-reports">
<div class="card">
<h3>تعداد کل درخواست‌ها: <span id="total-requests">0</span></h3>
</div>
<div class="card">
<h3>وضعیت درخواست‌ها</h3>
<table aria-label="گزارش وضعیت درخواست‌ها" class="report-table">
<thead>
<tr><th>وضعیت</th><th>تعداد</th></tr>
</thead>
<tbody>
<tr><td>در انتظار پرداخت</td><td id="count-pending">0</td></tr>
<tr><td>پرداخت شده</td><td id="count-paid">0</td></tr>
<tr><td>قبول شده</td><td id="count-accepted">0</td></tr>
<tr><td>تحویل شده</td><td id="count-delivered">0</td></tr>
</tbody>
</table>
</div>
<div class="card">
<h3>تعداد کاربران</h3>
<table aria-label="گزارش تعداد کاربران" class="report-table">
<thead>
<tr><th>نقش</th><th>تعداد</th></tr>
</thead>
<tbody>
<tr><td>درخواست کننده</td><td id="count-requester-users">0</td></tr>
<tr><td>پیک</td><td id="count-courier-users">0</td></tr>
<tr><td>ادمین</td><td id="count-admin-users">0</td></tr>
</tbody>
</table>
</div>
<div class="card">
<h3>درآمد کل (تومان)</h3>
<p id="total-revenue" style="font-size:1.5rem; font-weight:700; color:#3469e7;">0</p>
</div>
<div class="card">
<h3>ورود و خروج کاربران</h3>
<table class="report-table" id="login-log-table">
<thead>
<tr><th>کاربر</th><th>نقش</th><th>نوع</th><th>زمان</th></tr>
</thead>
<tbody></tbody>
</table>
</div><div class="card">
<h3>لیست کامل درخواست‌ها</h3>
<table class="report-table" id="all-requests-table">
<thead>
<tr>
<th>کاربر</th><th>توضیحات غذا</th><th>آدرس</th><th>وضعیت</th><th>پیک</th><th>زمان</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
<div class="card">
<h3>رمز عبور کاربران</h3>
<table class="report-table" id="user-passwords-table">
<thead>
<tr><th>نام کاربری</th><th>نقش</th><th>رمز عبور</th></tr>
</thead>
<tbody></tbody>
</table>
</div>
</div>
<button id="export-data-btn">دانلود پشتیبان اطلاعات</button></section>
</div>


 <script>
    const $ = selector => document.querySelector(selector);
    const AUTH_KEY = 'fd_auth';

    const signupBtn = $('#signup-btn');
    const loginBtn = $('#login-btn');
    const placeRequestBtn = $('#place-request-btn');

    const signupUsername = $('#signup-username');
    const signupPassword = $('#signup-password');
    const signupRole = $('#signup-role');
    const signupError = $('#signup-error');
    const signupSuccess = $('#signup-success');

    const loginUsername = $('#login-username');
    const loginPassword = $('#login-password');
    const loginRole = $('#login-role');
    const loginError = $('#login-error');

    const foodDesc = $('#food-desc');
    const deliveryAddress = $('#delivery-address');
    const receiptUpload = $('#receipt-upload');
    const receiptPreview = $('#receipt-preview');

    let currentAuth = JSON.parse(localStorage.getItem(AUTH_KEY));

    signupBtn.onclick = async () => {
      const username = signupUsername.value.trim();
      const password = signupPassword.value;
      const role = signupRole.value;
      signupError.style.display = 'none';
      signupSuccess.style.display = 'none';

      if (!username || username.length < 3) {
        signupError.textContent = 'نام کاربری باید حداقل ۳ حرف باشد.';
        signupError.style.display = 'block';
        return;
      }
      if (!password || password.length < 4) {
        signupError.textContent = 'رمز عبور باید حداقل ۴ حرف باشد.';
        signupError.style.display = 'block';
        return;
      }
      if (role === 'admin') {
        signupError.textContent = 'ثبت‌نام ادمین مجاز نیست.';
        signupError.style.display = 'block';
        return;
      }

      const res = await fetch('/api/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password, role })
      });

      const data = await res.json();
      if (!res.ok) {
        signupError.textContent = data.error;
        signupError.style.display = 'block';
        return;
      }

      signupSuccess.textContent = 'ثبت‌نام با موفقیت انجام شد. اکنون وارد شوید.';
      signupSuccess.style.display = 'block';
    };

    loginBtn.onclick = async () => {
      const username = loginUsername.value.trim();
      const password = loginPassword.value;
      const role = loginRole.value;
      loginError.style.display = 'none';

      const res = await fetch('/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password, role })
      });

      const data = await res.json();
      if (!res.ok) {
        loginError.textContent = data.error;
        loginError.style.display = 'block';
        return;
      }

      currentAuth = { username, role };
      localStorage.setItem(AUTH_KEY, JSON.stringify(currentAuth));
      location.reload();
    };

    receiptUpload.onchange = (e) => {
      const file = e.target.files[0];
      if (!file) {
        receiptPreview.style.display = 'none';
        return;
      }
      const reader = new FileReader();
      reader.onload = function (ev) {
        receiptPreview.src = ev.target.result;
        receiptPreview.style.display = 'block';
      }
      reader.readAsDataURL(file);
    };

    placeRequestBtn.onclick = async () => {
      const food = foodDesc.value.trim();
      const address = deliveryAddress.value.trim();
      const file = receiptUpload.files[0];
      if (!food || !address || !file || !currentAuth) {
        alert('لطفا همه فیلدها را کامل کنید.');
        return;
      }

      const formData = new FormData();
      formData.append('user', currentAuth.username);
      formData.append('foodDesc', food);
      formData.append('address', address);
      formData.append('receipt', file);

      const res = await fetch('/api/order', {
        method: 'POST',
        body: formData
      });

      const data = await res.json();
      if (!res.ok) {
        alert('خطا در ثبت سفارش: ' + data.error);
        return;
      }

      alert('درخواست با موفقیت ثبت شد.');
      foodDesc.value = '';
      deliveryAddress.value = '';
      receiptUpload.value = '';
      receiptPreview.style.display = 'none';
    };
  </script>
</body>
</html>
